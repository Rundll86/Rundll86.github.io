<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>快速开始 | FS-Context</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="一个易用的 ScratchExtension TypeScript 上下文">
    
    <link rel="preload" href="/fs-context/assets/css/0.styles.20e25bc4.css" as="style"><link rel="preload" href="/fs-context/assets/js/app.614ef848.js" as="script"><link rel="preload" href="/fs-context/assets/js/2.fbb53ce7.js" as="script"><link rel="preload" href="/fs-context/assets/js/1.8f9868f7.js" as="script"><link rel="preload" href="/fs-context/assets/js/31.6b0d0f39.js" as="script"><link rel="prefetch" href="/fs-context/assets/js/10.6775e288.js"><link rel="prefetch" href="/fs-context/assets/js/11.c854a8fc.js"><link rel="prefetch" href="/fs-context/assets/js/12.53640013.js"><link rel="prefetch" href="/fs-context/assets/js/13.9ab7ea56.js"><link rel="prefetch" href="/fs-context/assets/js/14.e1983dca.js"><link rel="prefetch" href="/fs-context/assets/js/15.af5aeb0c.js"><link rel="prefetch" href="/fs-context/assets/js/16.8f5c4b45.js"><link rel="prefetch" href="/fs-context/assets/js/17.698050eb.js"><link rel="prefetch" href="/fs-context/assets/js/18.c11468a5.js"><link rel="prefetch" href="/fs-context/assets/js/19.a60cbfcb.js"><link rel="prefetch" href="/fs-context/assets/js/20.74265ea7.js"><link rel="prefetch" href="/fs-context/assets/js/21.32417fce.js"><link rel="prefetch" href="/fs-context/assets/js/22.e58d7485.js"><link rel="prefetch" href="/fs-context/assets/js/23.2f5493b5.js"><link rel="prefetch" href="/fs-context/assets/js/24.7f52c4fc.js"><link rel="prefetch" href="/fs-context/assets/js/25.913127f0.js"><link rel="prefetch" href="/fs-context/assets/js/26.a54d1ede.js"><link rel="prefetch" href="/fs-context/assets/js/27.2e2dc785.js"><link rel="prefetch" href="/fs-context/assets/js/28.79c12770.js"><link rel="prefetch" href="/fs-context/assets/js/29.f0d63a19.js"><link rel="prefetch" href="/fs-context/assets/js/3.05eb4500.js"><link rel="prefetch" href="/fs-context/assets/js/30.92714be3.js"><link rel="prefetch" href="/fs-context/assets/js/32.0793bc5c.js"><link rel="prefetch" href="/fs-context/assets/js/33.0b073f1b.js"><link rel="prefetch" href="/fs-context/assets/js/34.958f2f0e.js"><link rel="prefetch" href="/fs-context/assets/js/35.022111fa.js"><link rel="prefetch" href="/fs-context/assets/js/36.d2014288.js"><link rel="prefetch" href="/fs-context/assets/js/37.501af242.js"><link rel="prefetch" href="/fs-context/assets/js/38.9854424c.js"><link rel="prefetch" href="/fs-context/assets/js/39.c0d413ed.js"><link rel="prefetch" href="/fs-context/assets/js/4.763ab0b0.js"><link rel="prefetch" href="/fs-context/assets/js/5.29447273.js"><link rel="prefetch" href="/fs-context/assets/js/6.d83f1018.js"><link rel="prefetch" href="/fs-context/assets/js/7.5d740f02.js"><link rel="prefetch" href="/fs-context/assets/js/vendors~docsearch.3e337192.js">
    <link rel="stylesheet" href="/fs-context/assets/css/0.styles.20e25bc4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fs-context/" class="home-link router-link-active"><!----> <span class="site-name">FS-Context</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>快速开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fs-context/guide/#还原依赖" class="sidebar-link">还原依赖</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fs-context/guide/#启动开发服务器" class="sidebar-link">启动开发服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fs-context/guide/#使用界面调试" class="sidebar-link">使用界面调试</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#使用编辑器调试" class="sidebar-link">使用编辑器调试</a></li></ul></li><li><a href="/fs-context/guide/#配置加载目标和平台" class="sidebar-link">配置加载目标和平台</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fs-context/guide/#使用范例拓展" class="sidebar-link">使用范例拓展</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#使用自定义拓展" class="sidebar-link">使用自定义拓展</a></li></ul></li><li><a href="/fs-context/guide/#部署翻译器" class="sidebar-link">部署翻译器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fs-context/guide/#创建翻译器" class="sidebar-link">创建翻译器</a></li></ul></li><li><a href="/fs-context/guide/#指定目标拓展" class="sidebar-link">指定目标拓展</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fs-context/guide/#设置拓展的元数据" class="sidebar-link">设置拓展的元数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fs-context/guide/#id、name、version、description" class="sidebar-link">ID、Name、Version、Description</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#主题色" class="sidebar-link">主题色</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#拓展贡献者列表" class="sidebar-link">拓展贡献者列表</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#定义积木【a计划】" class="sidebar-link">定义积木【A计划】</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#定义积木【b计划】" class="sidebar-link">定义积木【B计划】</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#定义菜单" class="sidebar-link">定义菜单</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#更灵活的菜单项写法" class="sidebar-link">更灵活的菜单项写法</a></li></ul></li><li><a href="/fs-context/guide/#实验中⚠" class="sidebar-link">实验中⚠</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fs-context/guide/#自定义参数处理器" class="sidebar-link">自定义参数处理器</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#动态调用loader和积木方法" class="sidebar-link">动态调用Loader和积木方法</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#使用类似rest的积木动态参数" class="sidebar-link">使用类似Rest的积木动态参数</a></li></ul></li><li><a href="/fs-context/guide/#关于配置文件" class="sidebar-link">关于配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fs-context/guide/#loader-ts" class="sidebar-link">loader.ts</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#server-js" class="sidebar-link">server.js</a></li><li class="sidebar-sub-header"><a href="/fs-context/guide/#webpack-js" class="sidebar-link">webpack.js</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="快速开始"><a href="#快速开始" class="header-anchor">#</a> 快速开始</h1> <p>在开始开发前，需要先进行一些准备。<br>
接下来所有教程的工作目录均位于<code>./src</code>目录内。要访问该目录给的内容，可使用<code>@src</code>别名来代替相对导入。</p> <h2 id="还原依赖"><a href="#还原依赖" class="header-anchor">#</a> 还原依赖</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="启动开发服务器"><a href="#启动开发服务器" class="header-anchor">#</a> 启动开发服务器</h2> <p>框架提供了两种调试拓展的方法。</p> <h3 id="使用界面调试"><a href="#使用界面调试" class="header-anchor">#</a> 使用界面调试</h3> <p>对于积木作用域和整体vm需求较小的拓展，可在WaterBox界面中调试。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> project dev ui
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="使用编辑器调试"><a href="#使用编辑器调试" class="header-anchor">#</a> 使用编辑器调试</h3> <p>对于功能较复杂的拓展，可载入编辑器进行调试。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> project dev extension
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="配置加载目标和平台"><a href="#配置加载目标和平台" class="header-anchor">#</a> 配置加载目标和平台</h2> <p>你可以选择让框架加载一个<strong>范例拓展</strong>，也可以使框架加载你的<strong>自定义拓展</strong>。修改<code>config/loader.ts</code>中的配置项即可实现。</p> <h3 id="使用范例拓展"><a href="#使用范例拓展" class="header-anchor">#</a> 使用范例拓展</h3> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ExtensionLoadError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@framework/exceptions&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LoaderConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@framework/internal&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Extension <span class="token keyword">from</span> <span class="token string">&quot;@samples/read-file/extension&quot;</span><span class="token punctuation">;</span> <span class="token comment">//从范例加载拓展</span>
<span class="token keyword">const</span> config<span class="token operator">:</span> LoaderConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> Extension<span class="token punctuation">,</span>
    errorCatches<span class="token operator">:</span> <span class="token punctuation">[</span>ExtensionLoadError<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//编译拓展加载流程中发生的错误</span>
    platform<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;TurboWarp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//加载到TurboWarp平台</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;debug&quot;</span> <span class="token comment">//调试模式，会自动输出一些信息</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="使用自定义拓展"><a href="#使用自定义拓展" class="header-anchor">#</a> 使用自定义拓展</h3> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ExtensionLoadError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@framework/exceptions&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LoaderConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@framework/internal&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Extension <span class="token keyword">from</span> <span class="token string">&quot;@src/extension&quot;</span><span class="token punctuation">;</span> <span class="token comment">//从源代码目录加载拓展</span>
<span class="token keyword">const</span> config<span class="token operator">:</span> LoaderConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> Extension<span class="token punctuation">,</span>
    errorCatches<span class="token operator">:</span> <span class="token punctuation">[</span>ExtensionLoadError<span class="token punctuation">]</span><span class="token punctuation">,</span>
    platform<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;GandiIDE&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//加载到GandiIDE平台</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;release&quot;</span> <span class="token comment">//生产模式，不会输出其他信息</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="基本代码结构"><a href="#基本代码结构" class="header-anchor">#</a> 基本代码结构</h1> <p>拓展的主要代码入口点位于<code>extension.ts</code></p> <h2 id="部署翻译器"><a href="#部署翻译器" class="header-anchor">#</a> 部署翻译器</h2> <p>在Gandi中使用<code>translate.setup</code>有一个致命问题，后加载的拓展将会<strong>全量覆盖</strong>先加载的拓展的翻译库，因此可以使用一个重新制作的翻译器来解决这个问题。对于将会使用<code>Transifex</code>平台且部署于<code>TurboWarp拓展库</code>的拓展，<strong>这个东西是没必要的</strong>。</p> <h3 id="创建翻译器"><a href="#创建翻译器" class="header-anchor">#</a> 创建翻译器</h3> <p>翻译器需要配置基本语言及其翻译库，并使用<code>Translator.create</code>方法进行创建。不要直接new，会失去类型检查。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">let</span> translator <span class="token operator">=</span> Translator<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;zh-cn&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;我的拓展&quot;</span><span class="token punctuation">,</span>
    des<span class="token operator">:</span> <span class="token string">&quot;这是我的第一个拓展&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>储存其他语言的翻译库时，使用<code>translator.store</code>方法，将会自动提示需要的键。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>translator<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;My Extension&quot;</span><span class="token punctuation">,</span>
    des<span class="token operator">:</span> <span class="token string">&quot;This is my first extension&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="指定目标拓展"><a href="#指定目标拓展" class="header-anchor">#</a> 指定目标拓展</h2> <p>将拓展的类原型作为一个<strong>默认导出</strong>，框架会自动加载。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyExtension</span> <span class="token keyword">extends</span> <span class="token class-name">Extension</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="设置拓展的元数据"><a href="#设置拓展的元数据" class="header-anchor">#</a> 设置拓展的元数据</h2> <h3 id="id、name、version、description"><a href="#id、name、version、description" class="header-anchor">#</a> ID、Name、Version、Description</h3> <p>覆盖<code>Extension</code>基类的字段即可。<br>
拓展的元数据本质上是字符串，因此可以使用<code>translator.load</code>方法进行翻译。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyExtension</span> <span class="token keyword">extends</span> <span class="token class-name">Extension</span> <span class="token punctuation">{</span>
    id <span class="token operator">=</span> <span class="token string">&quot;myextension&quot;</span><span class="token punctuation">;</span>
    displayName <span class="token operator">=</span> translator<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    version <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    description <span class="token operator">=</span> translator<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;des&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="主题色"><a href="#主题色" class="header-anchor">#</a> 主题色</h3> <p>覆盖<code>Extension</code>基类的<code>color字段</code>即可，类型为<code>ColorDefine</code>接口。<br>
可直接覆写<code>color</code>中的<code>theme</code>字段，框架可根据主题色自动推断<strong>三个分别变深的颜色</strong>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyExtension</span> <span class="token keyword">extends</span> <span class="token class-name">Extension</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> ColorDefine <span class="token operator">=</span> <span class="token punctuation">{</span>
        theme<span class="token operator">:</span> <span class="token string">&quot;#ff0000&quot;</span> <span class="token comment">//红色</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>也可以<strong>禁用</strong>框架的自动推断功能，自定义设置三个主题颜色，字段<code>block</code>、<code>inputer</code>、<code>menu</code>分别对应<strong>积木颜色</strong>、<strong>输入框颜色</strong>、<strong>菜单颜色</strong>。<br>
记得要将字段<code>autoDeriveColors</code>设为<code>false</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyExtension</span> <span class="token keyword">extends</span> <span class="token class-name">Extension</span> <span class="token punctuation">{</span>
    autoDeriveColors <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    color<span class="token operator">:</span> ColorDefine <span class="token operator">=</span> <span class="token punctuation">{</span>
        block<span class="token operator">:</span> <span class="token string">&quot;#ff0000&quot;</span><span class="token punctuation">,</span> <span class="token comment">//红色</span>
        inputer<span class="token operator">:</span> <span class="token string">&quot;#00ff00&quot;</span><span class="token punctuation">,</span> <span class="token comment">//绿色</span>
        menu<span class="token operator">:</span> <span class="token string">&quot;#0000ff&quot;</span> <span class="token comment">//蓝色</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="拓展贡献者列表"><a href="#拓展贡献者列表" class="header-anchor">#</a> 拓展贡献者列表</h3> <p>此功能可能不太必要，若想要匿名发布拓展<strong>可跳过此章节</strong>。<br>
反之可以覆盖<code>Extension</code>基类的<code>collaborators</code>字段，类型为<code>Collaborator[]</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyExtension</span> <span class="token keyword">extends</span> <span class="token class-name">Extension</span> <span class="token punctuation">{</span>
    collaborators<span class="token operator">:</span> Collaborator<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">Collaborator</span><span class="token punctuation">(</span><span class="token string">&quot;FallingShrimp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://f-shrimp.solariix.com&quot;</span><span class="token punctuation">)</span> <span class="token comment">//名称+链接</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="定义积木【a计划】"><a href="#定义积木【a计划】" class="header-anchor">#</a> 定义积木【A计划】</h3> <p><code>BlockType</code>命名空间中的所有方法（<code>BlockType.Plain</code>除外）都是装饰器工厂都可用于定义积木，例如其中<code>Command</code>装饰器可用于定义<strong>无返回值</strong>的<code>方形</code>积木，<code>Reporter</code>装饰器可用于定义<code>有返回值</code>的<code>圆形</code>积木，其他类型如<code>帽子</code>积木和<code>布尔</code>积木等同理。</p> <p><code>Plain</code>装饰器需要两个参数，第一个参数为积木类型，积木类型为<code>command</code>或<code>reporter</code>等，后一个参数传入积木上要显示的文字，其中，积木文字上可以使用一种实验性的字符串定义结构，框架能自动解析出参数名称、类型、默认值等。</p> <p>所有可用的装饰器接受的积木文字均可以使用美元符号<code>$</code>和分号<code>;</code>配对或一对方括号<code>[]</code>来定义参数框，填入参数名称，后接冒号<code>:</code>为参数的类型，可选择与上文<code>Block.create</code>方法中等价的类型，再后接等于号<code>=</code>为默认值，默认值必须为字符串，框架会自动将其转换为对应的类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">BlockType</span></span><span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">&quot;alert [sth:string=hello] with suffix $suffix:menu=suffixes;&quot;</span><span class="token punctuation">)</span>
<span class="token function">alertTest</span><span class="token punctuation">(</span>args<span class="token operator">:</span> <span class="token punctuation">{</span> sth<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> suffix<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>sth <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> args<span class="token punctuation">.</span>suffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这种方式下的写法和下文的「重载」功能相同，在本应传入文字的地方传入一个字符串数据即可。</p> <p><code>BlockMode</code>命名空间下的方法可以用于声明积木的一些非必要的配置。但是用于声明积木类型（也就是<code>BlockType</code>命名空间）的装饰器必须紧挨积木的实现，也就是非必要配置项的装饰器必须在积木类型配置之上。</p> <ul><li><strong>UseMonitor</strong> 对能返回的积木使用监视器，只能用在<code>Reporter</code>或<code>Boolean</code>上。</li> <li><strong>ThreadRestartable</strong> 设置事件积木的回调如果有正在运行的实例，那么允许打断它重启新的实例，只能用在<code>Hat</code>或<code>Event</code>上。</li> <li><strong>ActiveEdge</strong> 强制每一帧舞台更新时都会自动执行这个事件积木的实现，如果返回了<strong>真</strong>则开始执行其下回调，请注意性能问题。如果不使用这个功能则需要手动写一个原生事件侦听器并在积木可执行的时机使用<code>runtime.startHats</code>来启动。只能用在<code>Hat</code>上。</li> <li><strong>Filt</strong> 指定积木是用在角色上还是舞台上。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">BlockMode</span></span><span class="token punctuation">.</span><span class="token function">Filt</span><span class="token punctuation">(</span><span class="token string">&quot;sprite&quot;</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">BlockMode</span></span><span class="token punctuation">.</span>UseMonitor
<span class="token decorator"><span class="token at operator">@</span><span class="token function">BlockMode</span></span><span class="token punctuation">.</span>ThreadRestartable
<span class="token decorator"><span class="token at operator">@</span><span class="token function">BlockMode</span></span><span class="token punctuation">.</span>ActiveEdge
<span class="token decorator"><span class="token at operator">@</span><span class="token function">BlockType</span></span><span class="token punctuation">.</span><span class="token function">Reporter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">&quot;计算[num1:number=114]+[num2:number=514]&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;计算[num1:number=114]-[num2:number=514]&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;计算[num1:number=114]*[num2:number=514]&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;计算[num1:number=114]/[num2:number=514]&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">{</span> num1<span class="token punctuation">,</span> num2 <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> num1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> num2<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> overloadIndex<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> overloadMap <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">/</span> b
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> overloadMap<span class="token punctuation">[</span>overloadIndex<span class="token punctuation">]</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="定义积木【b计划】"><a href="#定义积木【b计划】" class="header-anchor">#</a> 定义积木【B计划】</h3> <p>使用<code>Block</code>类的静态方法<code>create</code>创建积木，参数依次为积木<strong>名称</strong>、<strong>参数</strong>、<strong>执行的方法</strong>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>Block<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
    <span class="token string">&quot;弹窗 $sth ，使用后缀 _suffix&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        arguments<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">&quot;$sth&quot;</span><span class="token punctuation">,</span>
                value<span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">,</span>
                inputType<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">&quot;_suffix&quot;</span><span class="token punctuation">,</span>
                value<span class="token operator">:</span> <span class="token string">&quot;已弹窗&quot;</span><span class="token punctuation">,</span>
                inputType<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token function">alertSth</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>$sth <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> args<span class="token punctuation">.</span>_suffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>积木参数的定义基于<code>ArgumentDefine</code>接口，其中<code>name</code>字段为<strong>参数框名称</strong>，<code>value</code>字段为<strong>参数框默认值</strong>。<br>
以下是对应字段的需求和默认值：</p> <table><thead><tr><th>字段</th> <th>是否必填</th> <th>默认值</th> <th>类型</th></tr></thead> <tbody><tr><td>name</td> <td>是</td> <td>无</td> <td>字符串</td></tr> <tr><td>value</td> <td>否</td> <td>空字符串</td> <td>任意</td></tr> <tr><td>inputType</td> <td>否</td> <td><code>string</code></td> <td><code>keyof InputTypeCast</code></td></tr></tbody></table> <h4 id="重载"><a href="#重载" class="header-anchor">#</a> 重载</h4> <p><code>Block.create</code>方法的第一个参数可以传入一个字符串数组，框架会自动将积木转换为可重载的积木按钮。</p> <h3 id="定义菜单"><a href="#定义菜单" class="header-anchor">#</a> 定义菜单</h3> <p>可以直接将积木的<code>inputType</code>改为<code>menu</code>，然后在<code>value</code>字段传入一个<code>Menu</code>类的实例，框架能够自动识别。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">{</span>
    arguments<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;$sth&quot;</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">,</span>
            inputType<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;_suffix&quot;</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">&quot;suffixes&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;已打印&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;printed&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;已输出&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;output&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;已显示&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;displayed&quot;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            inputType<span class="token operator">:</span> <span class="token string">&quot;menu&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>也可以在拓展数据中覆写<code>Extension</code>基类的<code>menus</code>字段，作为一个<code>Menu[]</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyExtension</span> <span class="token keyword">extends</span> <span class="token class-name">Extension</span> <span class="token punctuation">{</span>
    menus <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">&quot;suffixes&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;已打印&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;printed&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;已输出&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;output&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;已显示&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;displayed&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>菜单的定义基于<code>Menu</code>类，其中<code>name</code>字段为<strong>菜单名称</strong>，<code>items</code>字段为<strong>菜单项</strong>。菜单默认允许了<code>acceptReporters</code>，不需要手动声明。</p> <h3 id="更灵活的菜单项写法"><a href="#更灵活的菜单项写法" class="header-anchor">#</a> 更灵活的菜单项写法</h3> <p>框架提供了一种更灵活的写法来定义菜单项，可以防止出现轮子屎山。</p> <p>方式A（如下文<code>vegetables</code>菜单）：将项目列表放入一个数组，数组中项可以直接用字符串写<strong>菜单名称</strong>，也可使用等于号<code>=</code>连接<strong>菜单项名称</strong>和<strong>对应值</strong>，框架会自动将<strong>菜单项名称</strong>作为菜单项的<code>name</code>字段，<strong>对应值</strong>作为菜单项的<code>value</code>字段。若没有使用等于号，框架会自动将<strong>菜单项名称</strong>同时作为菜单项的<code>name</code>字段和<code>value</code>字段。</p> <p>方式B（如下文<code>sauces</code>菜单）：将项目列表放入一个字符串，使用英文逗号<code>,</code>分隔，项类型同上，不过在这种写法下无法使用声明对象的方式来指定<code>name</code>字段和<code>value</code>字段。</p> <details class="custom-block details"><summary>TS</summary> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">&quot;vegetables&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;土豆=potato&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;胡萝卜=carrot&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Unnamed vegitable&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Named vegitable of Onion&quot;</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">&quot;onion&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Cabbage白菜&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">&quot;sauces&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;番茄酱=ketchup,蛋黄酱=mayonnaise,mushroom,辣椒酱=hot sauce&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details> <p>这两段代码等价于：</p> <details class="custom-block details"><summary>TS</summary> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">&quot;vegetables&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;土豆&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;potato&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;胡萝卜&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;carrot&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Unnamed vegitable&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;Unnamed vegitable&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Named vegitable of Onion&quot;</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">&quot;onion&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Cabbage白菜&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;Cabbage白菜&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">&quot;sauces&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;番茄酱&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;ketchup&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;蛋黄酱&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;mayonnaise&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;mushroom&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;mushroom&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;辣椒酱&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;hot sauce&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></details> <p>不过这种写法需要堆砌很多<code>{ name: &quot;xxx&quot;, value: &quot;xxx&quot; }</code>，因此框架省去了此轮子写法。</p> <p>关于菜单<code>sauces</code>，将会被框架生成为TW格式：</p> <details class="custom-block details"><summary>JSON</summary> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;acceptReporters&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;items&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;番茄酱&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ketchup&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;蛋黄酱&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mayonnaise&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mushroom&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mushroom&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;辣椒酱&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hot sauce&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></details> <p>菜单<code>vegetables</code>同理：</p> <details class="custom-block details"><summary>JSON</summary> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;acceptReporters&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;items&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;土豆&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;potato&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;胡萝卜&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;carrot&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Unnamed vegitable&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Unnamed vegitable&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Named vegitable of Onion&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;onion&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Cabbage白菜&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Cabbage白菜&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></details> <h2 id="实验中⚠"><a href="#实验中⚠" class="header-anchor">#</a> 实验中⚠</h2> <h3 id="自定义参数处理器"><a href="#自定义参数处理器" class="header-anchor">#</a> 自定义参数处理器</h3> <p>框架有一个新的loader系统，类似WebpackLoader。<br>
在拓展的<code>loaders</code>字段中添加一个键，类型为<code>InputLoader</code>。对应值中<code>load</code>方法为转换器的实现，<code>format</code>字段传入一个正则表达式，用于检查输入的参数是否符合格式。框架会将使用此loader的参数生成的TW格式拓展的输入类型永远设为<code>string</code>，积木的实现中收到的参数结果将会是对应loader的返回值。</p> <p>如果输入的内容不符合设定的格式，或loader运行过程中报错，那么参数的对应字段将会得到<code>null</code>，你可以通过设置loader的可选字段<code>defaultValue</code>属性来设置默认值。</p> <p>下面是一个例子，自动加载json字符串：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>loaders<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> InputLoader<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    json<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">load</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        format<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[(.*)\]|\{(.*)\}|&quot;(.*)&quot;</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//允许json对象、数组或字符串类型</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
blocks<span class="token operator">:</span> Block<span class="token operator">&lt;</span>MyExtension<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    Block<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;TestBlock $sth&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        arguments<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">&quot;$sth&quot;</span><span class="token punctuation">,</span>
                inputType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token comment">//输入类型填loader的字段名</span>
                value<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{&quot;apple&quot;: &quot;苹果&quot;}</span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出{ $sth: { apple: &quot;苹果&quot; } }</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>你也可以从<code>@framework</code>别名中导入一些已预定义的loader，如<code>json</code>、<code>html</code>、<code>vector2</code>、<code>vector3</code>等。只需按照简写写法同上文的格式添加到<code>loaders</code>字段中。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> json<span class="token punctuation">,</span> vector2<span class="token punctuation">,</span> vector3 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@framework/built-ins/loaders&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code>loaders<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> InputLoader<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    html<span class="token punctuation">,</span>
    json<span class="token punctuation">,</span>
    vector2<span class="token punctuation">,</span>
    vector3
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>用法同上，无需多言。</p> <h3 id="动态调用loader和积木方法"><a href="#动态调用loader和积木方法" class="header-anchor">#</a> 动态调用Loader和积木方法</h3> <p>在积木的实现中，可以使用this.call为前缀的方法来动态调用参数loader和已实现的积木方法（出于安全性考虑，只能调用本拓展的内容），不过这个方法下请小心会发生未预料的递归爆栈。用法无需多言。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callLoader</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span> <span class="token comment">/* 加载器的字段名 */</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{&quot;apple&quot;:&quot;苹果&quot;}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//{ apple: &quot;苹果&quot; }</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callBlock</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span> <span class="token comment">/* 积木的opcode */</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">114</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">514</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//628</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="使用类似rest的积木动态参数"><a href="#使用类似rest的积木动态参数" class="header-anchor">#</a> 使用类似Rest的积木动态参数</h3> <p>在积木参数的配置对象中添加一个名为<code>rest</code>的字段，其内容实现<code>DynamicArgConfigDefine</code>接口，即可将这个参数转换为动态参数。每个积木只能使用一个动态参数，且因为实现原因，只能使用<code>string</code>、<code>number</code>、<code>bool</code>类型或者任意的loader，其他类型不行。当使用了loader时将会收到每个动态参数经过loader转换的结果。在积木的实现方法中收到的对应的参数字段将直接得到处理过的数组。</p> <p>使用装饰器来定义积木时暂时不能用这种方法。</p> <p>配置项：</p> <p><strong>defaultValues</strong><br>
类型：字符串或其数组或一个返回字符串的函数<br>
作用：动态参数的默认值<br>
写法：</p> <ul><li>当填字符串时，所有动态参数都使用这个默认值</li> <li>当填字符串数组时，动态参数在数组项足够时按顺序分配默认值，数量超出数组长度了就把数组最后一项末尾加超出的数字</li> <li>当填函数时，接收当前正在生成的参数框的序数，可以按照序数来随便计算并且返回默认值</li></ul> <p><strong>joinCh</strong><br>
类型：字符串或一个返回字符串的函数<br>
作用：每个框中间间隔的内容<br>
写法：</p> <ul><li>当填字符串时，直接用</li> <li>当填函数时，接收当前正在生成的参数框的序数，可以按照序数来随便计算并且返回间隔符</li></ul> <p><strong>preText</strong><br>
类型：同上<br>
作用：第一个参数框之前的文本<br>
写法：</p> <ul><li>当填字符串时，直接用</li> <li>当填函数时，接收当前已生成的参数框的数量，可以按照数量来随便计算并且返回</li></ul> <p><strong>endText</strong><br>
类型：同上<br>
作用：最后一个参数框之后的文本<br>
写法：</p> <ul><li>当填字符串时，直接用</li> <li>当填函数时，接收当前已生成的参数框的数量，可以按照数量来随便计算并且返回</li></ul> <p><strong>paramsIncrement</strong><br>
类型：整数或其数组<br>
作用：每次点击添加参数框时，添加的框数量<br>
写法：</p> <ul><li>当填整数时，直接用</li> <li>当填数组时，每次一点添加框就按照数组顺序来获得对应数量，但是能添加的框数量不能超过数组长度</li></ul> <p>示例用法：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * 一个支持动态框的字符串参数，前两个框默认值分别是Hello World，之后就是World1、World2、World3...
 * 每个框之间用逗号隔开。
 */</span>
arguments<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;$array&quot;</span><span class="token punctuation">,</span>
        inputType<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        rest<span class="token operator">:</span> <span class="token punctuation">{</span>
            defaultValues<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            joinCh<span class="token operator">:</span> <span class="token string">&quot;,&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment">// 生成积木 =&gt; [arg1=Hello] [arg2=World] [arg3=World1] [arg4=World2] [arg5=World3] [,argX...=World(X-2)]</span>

<span class="token comment">// 积木实现中得到的参数对象：</span>
arg <span class="token operator">=</span> <span class="token punctuation">{</span>
    $array<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;World1&quot;</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>动态框模块出处与致谢：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * @description 使拓展积木支持动态参数，基于Blockly注入
 * 
 * @author Nights        - 原作者
 * @author FurryR        - 原作者
 * @author zxq           - 原作者
 * @author FallingShrimp - 优化&amp;整合
 */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="关于配置文件"><a href="#关于配置文件" class="header-anchor">#</a> 关于配置文件</h2> <h3 id="loader-ts"><a href="#loader-ts" class="header-anchor">#</a> loader.ts</h3> <p>用于配置拓展加载时的行为，<code>target</code>字段设置目标加载的拓展，<code>errorCatches</code>设置在WaterBox中运行时将会尝试捕获哪些错误，<code>platform</code>指定目标加载的平台，<code>GandiIDE</code>或<code>TurboWarp</code>。</p> <h3 id="server-js"><a href="#server-js" class="header-anchor">#</a> server.js</h3> <p>用于配置开发服务器的输出和端口等通用信息。<code>port</code>指定开发服务器的端口，<code>output</code>指定生产模式输出的文件名前缀。</p> <h3 id="webpack-js"><a href="#webpack-js" class="header-anchor">#</a> webpack.js</h3> <p>通用于开发环境和生产环境的webpack配置，包含通用loader（ts-loader等）、导入别名、开发服务器配置等。你可以添加需要的loader来自定义导入内容。</p> <p>接下来，请查看<a href="./api/unnecessary">拓展开发时的常用工具集</a>、<a href="./standalone">编写无入口的独立模块</a>或<a href="./api/general">已释放的通用API</a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/fs-context/assets/js/app.614ef848.js" defer></script><script src="/fs-context/assets/js/2.fbb53ce7.js" defer></script><script src="/fs-context/assets/js/1.8f9868f7.js" defer></script><script src="/fs-context/assets/js/31.6b0d0f39.js" defer></script>
  </body>
</html>
